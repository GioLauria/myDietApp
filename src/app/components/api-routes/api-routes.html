<div class="api-routes-container">
  <div class="header">
    <div>
      <h2>API Routes</h2>
      <p class="subtitle">Overview of all backend endpoints available in this app.</p>
    </div>
    <div class="summary" *ngIf="!loading() && !error()">
      <span class="summary-chip">Total routes: {{ routes().length }}</span>
      <button mat-raised-button
              color="primary"
              class="export-button"
              *ngIf="canExportPostman()"
              [disabled]="downloading()"
              (click)="exportPostmanCollection()">
        <mat-icon fontIcon="file_download"></mat-icon>
        <span>Export Postman Collection</span>
      </button>
    </div>
  </div>
  
  <div *ngIf="loading()" class="loading-spinner">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="error()" class="error-message">
    {{ error() }}
  </div>

  <mat-card *ngIf="!loading() && !error()">
    <div class="area-filter" *ngIf="groupedRoutes().length">
      <button type="button"
              class="area-pill"
              [class.active]="selectedArea() === 'All'"
              (click)="selectArea('All')">
        All
      </button>
      <button type="button"
              class="area-pill"
              *ngFor="let group of groupedRoutes()"
              [class.active]="selectedArea() === group.area"
              (click)="selectArea(group.area)">
        {{ group.area }}
      </button>
    </div>

    <ng-container *ngIf="groupedRoutes().length; else noRoutes">
      <div *ngFor="let group of visibleGroups" class="area-block">
        <div class="area-header">
          <h3 class="area-title">{{ group.area }}</h3>
          <span class="area-count">{{ group.routes.length }} route{{ group.routes.length === 1 ? '' : 's' }}</span>
        </div>

        <table mat-table [dataSource]="group.routes" class="routes-table">
          <!-- Method Column -->
          <ng-container matColumnDef="method">
            <th mat-header-cell *matHeaderCellDef> Method </th>
            <td mat-cell *matCellDef="let route"> 
              <span class="method-badge" [ngClass]="route.method.toLowerCase()">{{ route.method }}</span>
            </td>
          </ng-container>

          <!-- Path Column -->
          <ng-container matColumnDef="path">
            <th mat-header-cell *matHeaderCellDef> Path </th>
            <td mat-cell *matCellDef="let route"> {{ route.path }} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Description </th>
            <td mat-cell *matCellDef="let route"> {{ route.description }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="route-row"></tr>
        </table>
      </div>
    </ng-container>
    <ng-template #noRoutes>
      <div class="empty-state">
        <h3>No routes found</h3>
        <p>If the server just started, try refreshing this page.</p>
      </div>
    </ng-template>
  </mat-card>
</div>
